## roles/desktop/tasks/main.yml
## Role main file
# vim:ft=yaml.ansible:
---
## Include distribution specific variables
- include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution }}.yml"
    - "{{ ansible_os_family }}.yml"

## Install Xorg packages
- name: "Install Xorg"
  package:
    name:  '{{ item }}'
    state: present
  with_flattened: '{{ xorg }}'
  when: xorgpkg
  ignore_errors: yes
  tags: xorg

## Install sound stuff
- name: "Install Sound"
  package:
    name: '{{ item }}'
    state: present
  with_flattened: '{{ sound }}'
  when: xorgpkg and 'Fedora' not in ansible_distribution
  tags: sound

  ## Install custom keyboard layout. Can be disregarded.
- name: OP keybinding
  template:
    src: op.j2
    dest: /usr/share/X11/xkb/symbols/op
  tags: keybinding

## Sets keymap to Swedish
- name: Set Keymap
  command: localectl set-x11-keymap se
  tags: keybinding

## Run distribution specific installs.
- include_tasks: '{{ outer_dist }}'
  with_first_found:
    - "{{ ansible_distribution }}.yml"
    - "{{ ansible_os_family }}.yml"
  loop_control:
    loop_var: outer_dist

## Fluff ...
- name: Tomorrow-Night KDE colour scheme (assure dir exists)
  file:
    path: /usr/share/color-schemes
    state: directory
    mode: 0770
    owner: root
    group: root
  when: kdepkg

- name: Tomorrow-Night KDE colour scheme (template)
  template:
    src: TomorrowNight.colors.j2
    dest: /usr/share/color-schemes/TomorrowNight.colors
  when: kdepkg

## Assure i3 config exists
- name: .config/i3 dir
  file:
    path: /home/{{ i3user }}/.config/i3
    state: directory
    mode: 0750
    owner: '{{ i3user }}'
    group: '{{ i3group }}'
  when: i3pkg

## Modify i3 config
- name: i3 configs
  template:
    src: '{{ item.name }}'
    dest: '{{ item.dest }}'
    owner: '{{ i3user }}'
    group: '{{ i3group }}'
    mode: 0750
  with_items:
    - { name: 'i3config.j2', dest: '/home/{{ i3user }}/.config/i3/config' }
    - { name: 'i3status.conf.j2', dest: '/home/{{ i3user }}/.config/i3status.conf' }
  tags: i3
  ignore_errors: yes
  when: i3pkg

- name: i3 conky bar
  template:
    src: conkyrc.j2
    dest: '/home/{{ i3user }}/.config/conkyrc'
    owner: '{{ i3user }}'
    group: '{{ i3group }}'
  tags: i3
  when: i3pkg

- name: i3 conky run script
  template:
    src: '{{ item }}.j2'
    dest: '/home/{{ i3user }}/.config/{{ item }}'
    owner: '{{ i3user }}'
    group: '{{ i3group }}'
    mode: 0770
  with_items:
    - conky-i3bar
    - i3temp.sh
  tags: i3
  when: i3pkg
# install conky on non-Arch distros
...
